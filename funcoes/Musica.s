.data
# oak-s-lab.mid	, Track1	-> fase 0
OaksLabMsc: .word 164, 
59, 108, 61, 108, 62, 108, 64, 108, 66, 108, 68, 108, 69, 108, 71, 108, 73, 108, 71, 217, 73, 217, 69, 108, 68, 217, 69, 217, 71, 108, 69, 326, 69, 108, 68, 108, 71, 108, 73, 108, 69, 108, 68, 217, 69, 217, 66, 108, 64, 217, 66, 217, 68, 108, 66, 326, 66, 217, 64, 108, 69, 108, 64, 108, 69, 108, 74, 217, 73, 108, 69, 108, 73, 108, 76, 217, 74, 108, 73, 108, 71, 108, 69, 108, 68, 108, 64, 326, 64, 108, 66, 108, 68, 108, 73, 108, 71, 217, 73, 217, 69, 108, 68, 217, 69, 217, 71, 108, 69, 326, 69, 108, 68, 108, 71, 108, 73, 108, 69, 108, 68, 217, 69, 217, 66, 108, 64, 217, 66, 217, 68, 108, 66, 326, 66, 217, 64, 108, 69, 108, 64, 108, 69, 108, 74, 217, 73, 108, 69, 108, 73, 108, 76, 217, 74, 108, 73, 108, 71, 108, 69, 108, 68, 108, 64, 326, 64, 108, 66, 108, 68, 108, 73, 108, 71, 217, 73, 217, 69, 108, 68, 217, 69, 217, 71, 108, 69, 326, 69, 108, 68, 108, 71, 108, 73, 108, 69, 108, 68, 217, 69, 217, 66, 108, 64, 217, 66, 217, 68, 108, 66, 326, 66, 217, 64, 108, 69, 108, 64, 108, 69, 108, 74, 217, 73, 108, 69, 108, 73, 108, 76, 217, 74, 108, 73, 108, 71, 108, 69, 108, 68, 108, 64, 326, 64, 108, 66, 108, 68, 108, 73, 108, 71, 217, 73, 217, 69, 108, 68, 217, 69, 217, 71, 108, 69, 326, 69, 108, 68, 108, 71, 108, 73, 108, 69, 108, 68, 217, 69, 217, 66, 108, 64, 217, 66, 217, 68, 108, 66, 326, 66, 217, 64, 108, 69, 108, 64, 108, 69, 108, 74, 217, 73, 108, 69, 108, 73, 108, 76, 217, 74, 108, 73, 108, 71, 108, 69, 108, 68, 108, 64, 326, 64, 108, 66, 108, 68, 108 

# route-1.mid , Track3		-> fase 1
Route1Msc: .word 175, 78, 1250, 78, 250, 78, 250, 78, 500, 78, 250, 78, 250, 78, 500, 78, 250, 79, 375, 78, 125, 76, 500, 76, 750, 76, 250, 76, 250, 76, 500, 76, 250, 76, 250, 76, 500, 76, 250, 78, 125, 79, 250, 78, 125, 74, 500, 78, 750, 78, 250, 78, 250, 78, 500, 78, 250, 78, 250, 78, 500, 78, 250, 79, 375, 78, 125, 76, 500, 76, 750, 76, 250, 76, 250, 73, 500, 73, 250, 71, 250, 73, 250, 79, 500, 73, 500, 74, 500, 78, 250, 78, 125, 79, 125, 81, 250, 81, 250, 78, 250, 74, 250, 86, 250, 85, 250, 83, 250, 85, 250, 81, 250, 78, 250, 74, 375, 78, 125, 76, 500, 78, 250, 78, 125, 79, 125, 81, 250, 81, 250, 78, 250, 81, 250, 86, 250, 85, 250, 83, 375, 79, 125, 81, 250, 86, 250, 85, 250, 88, 250, 86, 500, 78, 750, 78, 250, 78, 250, 78, 500, 78, 250, 78, 250, 78, 500, 78, 250, 79, 375, 78, 125, 76, 500, 76, 750, 76, 250, 76, 250, 76, 500, 76, 250, 76, 250, 76, 500, 76, 250, 78, 125, 79, 250, 78, 125, 74, 500, 78, 750, 78, 250, 78, 250, 78, 500, 78, 250, 78, 250, 78, 500, 78, 250, 79, 375, 78, 125, 76, 500, 76, 750, 76, 250, 76, 250, 73, 500, 73, 250, 71, 250, 73, 250, 79, 500, 73, 500, 74, 500, 78, 250, 78, 125, 79, 125, 81, 250, 81, 250, 78, 250, 74, 250, 86, 250, 85, 250, 83, 250, 85, 250, 81, 250, 78, 250, 74, 375, 78, 125, 76, 500, 78, 250, 78, 125, 79, 125, 81, 250, 81, 250, 78, 250, 81, 250, 86, 250, 85, 250, 83, 375, 79, 125, 81, 250, 86, 250, 85, 250, 88, 250, 86, 500, 78, 750, 78, 250, 78, 250, 78, 500, 78, 250, 78, 250, 78, 500, 78, 250, 79, 375, 78, 125, 76, 500, 76, 750, 76, 250, 76, 250, 73, 500, 73, 250, 71, 250, 73, 250, 79, 500, 73, 500, 78, 250, 69, 250, 74, 500 

.text
Musica:
	addi	sp, sp, -20
	sw	ra, 0(sp)
	sw	a0, 4(sp)
	sw	a1, 8(sp)
	sw	a2, 12(sp)
	sw	a3, 16(sp)
	
	call	DecideMusica		# a0 <- label da musica da fase
	
	mv	t0, a0
	lw	t1, 0(t0)		# q. de notas
	la	t2, noteCount
	lw	t3, 0(t2)
	beq	t3, t1, recomecaMsc
	
	slli	t4, t3, 3
	addi	t0, t0, 4		# pula o primeiro valor (q. de notas)
	add	t0, t0, t4
	
	lw	a1, 4(t0)		# duracao	
	la	t4, lastTimeMsc
	lw	t5, 0(t4)	
	csrr	t6, time
	sub	t5, t6, t5
	bltu	t5, a1, fimMusica	# ultima nota terminou ?
	
	sw	t6, 0(t4)	
	addi	t3, t3, 1		# cont de nota ++
	sw	t3, 0(t2)
	
	lw	a0, 0(t0)		# nota
	li	a2, 0			# instrumento (fpga = piano)
	li	a3, 50			# volume
	li	a7, 31
	ecall	
	
	j	fimMusica
recomecaMsc:
	sw	zero, 0(t2)
fimMusica:
	lw	ra, 0(sp)
	lw	a0, 4(sp)
	lw	a1, 8(sp)
	lw	a2, 12(sp)
	lw	a3, 16(sp)
	addi	sp, sp, 20
	ret
###


DecideMusica:
	la	t0, fase
	lbu	t0, 0(t0)
	
	beqz	t0, mscFase0
	li	t1, 1
	beq	t0, t1, mscFase1
	li	t1, 2
	beq	t0, t1, mscFase2
fimDecideMusica:
	ret
	
mscFase0:	
	la	a0, OaksLabMsc		# embutir no musica modulo EscolheMusica
	j	fimDecideMusica
mscFase1:	
	la	a0, Route1Msc		# embutir no musica modulo EscolheMusica
	j	fimDecideMusica
mscFase2:	
	la	a0, OaksLabMsc		# embutir no musica modulo EscolheMusica
	j	fimDecideMusica
